<!DOCTYPE html><html><head><script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script><script type="text/javascript" src="../javascripts/jquery.tmpl.min.js"></script><script type="text/javascript" src="../javascripts/flot/jquery.flot.min.js"></script><link rel="stylesheet" href="../stylesheets/benchmarks.css"><title>Alfred.js</title></head><body><div id="header"><h1><a href="../index.html">Alfred</a></h1><p><i>Node is your mansion, Alfred is your butler</i></p><div id="menu"><ul><li><a href="../api.html">API</a></li><li><a href="../examples.html">Examples</a></li><li><a href="../features.html">Features</a></li><li><a href="../internals.html">Internals</a></li><li><a href="../benchmarks.html">Benchmarks</a></li><li><a href="https://github.com/pgte/alfred">Browse source</a></li><li><a href="../index.html">Home</a></li></ul></div></div><div id="main"><div id="container"><p class="note">Everything here is experimental, and the API is no exception, so expect things to change in future releases.</p><div id="api"><h2>Alfred.open (path_to_database, [options, ] callback)</h2><p>Opens a new or an existing database that resides in <i>path_to_database</i>.</p><p><ul><li><b>path_to_database</b>: directory where the database files (will) reside. Must already exist.</li><li><b>callback</b> (err, db): invoked when there is an error or the database is open. Use db to access / create / remove key maps.</li><li><b>options:</b><ul><li><b>meta_compact_interval</b>: default average compact interval for the metadata key map, in miliseconds. Defaults to 1 hour (1000 * 60 * 60).</li><li><b>replication_master</b>: true if this database is going to act as a replication master. Defaults to false.</li><li><b>replication_port</b>: replication server port for this database. Defaults to 5293.</li><li><b>replication_max_temp_file_size_kb</b>: maximum file size for replication temporary files on master. Defaults to 10000 KBytes.</li></ul></li></ul></p><h3>Example:</h3><pre><code>var Alfred = require('alfred');
Alfred.open('path/to/database/dir', function(err, db) {
  if (err) { throw err; }
  // now I have the db object to do stuff
});
</code></pre><h2>database.attach (key_map_name [, options], callback)</h2><p>Attaches a key map to this database.</p><p><ul><li><b>key_map_name</b>: name of this key map. Will be available as a named property of database (<i>database.&lt;key_map_name&gt;</i> or <i>database[key_map_name]</i>).</li><li><b>callback</b> (err, key_map): invoked when there is an error or the key map is attached.</li><li><b>options</b>:<ul><li><b>buffered</b>: if <i>true</i>, writes are buffered (flushes are scheduled every second after the last one by default). If <i>false</i>, key_map.put only callsback when data is written to disk. Defaults to <i>true</i>.</li><li><b>flush_interval</b>: This determines the frequency of flushes. A flush is scheduled <i>flush_interval</i> miliseconds after the last one finished. In miliseconds. Defaults to 1000 (1 second).</li><li><b>type</b>: can be 'cached_key_map' or 'indexed_key_map'. Defaults to 'cached_key_map'. ('cached_key_map' is also indexed)</li><li><b>compact_interval</b>: average compact interval, in miliseconds. Defaults to 1 hour (1000 * 60 * 60).</li><li><b>cache_slots</b>: Maximum number of objects to cache (only valid if type is 'cached_key_map'). Defaults to 1000.</li></ul></li></ul><h3>Example:</h3><pre><code>var Alfred = require('alfred');
Alfred.open ('path/to/database/dir', function(err, db) {
  if (err) { throw err; }
  console.log(db.users); // -> undefined
  db.attach ('users', function(err, users_key_map) {
    if (err) { throw err; }
    // now you can use users_key_map
  })
});
</code></pre></p><h2>database.ensure (key_map_name [, options], callback)</h2><p>If not attached, attaches this key map.</p><p>If already attached does nothing. If you need to change the options on this key_map, you must detach and then attach.</p><h3>Example:</h3><pre><code>var Alfred = require('alfred');
Alfred.open('path/to/database/dir', function(err, db) {
  if (err) { throw err; }
  db.ensure ('users', function(err, users_key_map) {
    if (err) { throw err; }
    // now you can use users_key_map
  })
});
</code></pre><h2>database.detach (key_map_name, callback)</h2><p>Detaches a key map from this database.</p><p><i>database.&lt;key_map_name&gt;</i> must already be attached.</p><p><ul><li><b>key_map_name</b>: name of the key map to be detached.</li><li><b>callback</b> (err): invoked when an error occurs or when key map is detached.</li></ul><h3>Example:</h3><pre><code>var Alfred = require('alfred');
Alfred.open('path/to/database/dir', function(err, db) {
  if (err) { throw err; }
  console.log('users' in db); // -> true
  db.detach('users', function(err) {
    if (err) { throw err; }
    console.log(db.users); // -> undefined
  })
});
</code></pre></p><h2>database.close (callback)</h2><p>Closes all key maps and meta data.</p><p>You should call this before leaving.</p><p><ul><li><b>callback</b> (err): when an error occurs or the database ends.</li></ul></p><h1>Events</h1><p>Bind to events like this:</p><p><pre><code>db.on('error', function(err) {
  // handle error
});
</code></pre></p><h2>'error'</h2><p>Emitted when there is an unhandled error. You should catch these.</p><p><b>callback</b> (err)</p><h2>'key_map_attached'</h2><p>Emitted when a key map is attached into this database.</p><p><b>callback</b> (key_map_name)</p><h2>'index_added'</h2><p>Emitted when an index is added into a key map attached to this db.</p><p><b>callback</b> (key_map_name, index_name)</p><h2>'index_dropped'</h2><p>Emitted when an index is removed from a key map attached to this db.</p><p><b>callback</b> (key_map_name, index_name)</p></div></div><div id="footer">&copy; Pedro Teixeira <a href="http://metaduck.com">Blog</a> &middot; <a href="https://github.com/pgte">GitHub</a> &middot; <a href="http://twitter.com/pedrogteixeira">@pedrogteixeira</a>
</div></div></body></html>