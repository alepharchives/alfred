<!DOCTYPE html><html><head><script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script><script type="text/javascript" src="../javascripts/jquery.tmpl.min.js"></script><link href="../stylesheets/prettify.css" type="text/css" rel="stylesheet"><script type="text/javascript" src="../javascripts/prettify/prettify.js"></script><script type="text/javascript" src="../javascripts/flot/jquery.flot.min.js"></script><link rel="stylesheet" href="../stylesheets/benchmarks.css"><title>Alfred.js</title></head><body onload=" prettyPrint()"><div class="ribbon"><a href="https://github.com/pgte/alfred" rel="me">Fork me on GitHub</a></div><div id="header"><h1><a href="../index.html">Alfred<span class="js">.js</span></a></h1><p><i>Node is your mansion, Alfred is your butler</i></p><div id="menu"><ul><li><a href="../api.html">API</a></li><li><a href="../examples.html">Examples</a></li><li><a href="../features.html">Features</a></li><li><a href="../internals.html">Internals</a></li><li><a href="../benchmarks.html">Benchmarks</a></li><li><a href="https://github.com/pgte/alfred">Browse source</a></li><li><a href="../index.html">Home</a></li></ul></div></div><div id="main"><div id="container"><div id="internals"><h1>Replication internals</h1><p class="note">Replication is still very crudely implemented. The slave gets all the existing data on the first connection, which is less than optimal. As everything here, use it at your own risk.</p><h2>Master</h2><p>Master can bind a replication TCP server to a designed port (port 5293 by default).</p><p>The master server sits listens to command requests from slaves.</p><p>For now, the only supported command is 'SYNC'.</p><p>When it receives a SYNC command, the master transmits:</p><p><ol><li>the metadata key map (containing the current key maps and indexes)</li><li>the exisiting data</li></ol></p><p>and then it starts transmitting live data.</p><h3>Format</h3><p>All transmissions use the JSON format, separated by line feeds.</p><h3>Internals internals</h3><p>For each slave connection, the master buffers the transmission data using temporary files. These temporary files roll-over when they reach a configurable maximum.</p><h2>Slave</h2><p>A slave connects to the master and sends a SYNC command.</p><p>As it receives action commands, it starts applying them to the local database.</p><h2>Transmission command structure</h2><p>meta commands:<pre><code>{m: 'meta', command: &lt;command_name&gt;, arguments: &lt;arguments&gt;}
</code></pre></p><p>data commands:<pre><code>{m: &lt;key_map_name&gt;, k: &lt;key&gt;, v: &lt;value&gt;}
</code></pre></p><p>Valid meta commands are:</p><h3>attach_key_map (key_map_name, options)</h3><p>options:<ul><li><b>type</b>: 'cached_key_map' (default) or 'indexed_key_map'</li><li><b>compact_interval</b>: in miliseconds. Defaults to 1 hour.</li></ul></p><h3>detach_key_map (key_map_name)</h3><h3>add_index (key_map_name, index_name, options, transform_function)</h3><p>options:<ul><li><b>ordered</b>: true or false</li></ul></p><h3>drop_index (key_map_name, index_name)</h3></div></div><div id="footer">&copy; Pedro Teixeira <a href="http://metaduck.com">Blog</a> &middot; <a href="https://github.com/pgte">GitHub</a> &middot; <a href="http://twitter.com/pedrogteixeira">@pedrogteixeira</a>
</div></div></body></html>